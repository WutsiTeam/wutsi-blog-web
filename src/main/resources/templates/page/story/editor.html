<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <div th:replace="components/layout :: head"></div>
</head>

<body>

<div th:replace="components/layout :: navbar"></div>

<div class="alert alert-danger container margin-top" th:if="${error}" th:text="#{'error.' + ${error}}">Error</div>

<div class="container editor border margin-top">

    <div class="row border-bottom">
        <div class="col-12 padding">
            <div id="story-status" class="float-left margin-right" th:text="#{story.status.draft}"></div>
            <div id="editor-status" class="float-left"></div>

            <div class="close">
                <a href="/story/draft" wutsi-track-event="story.editor.close">X</a>
            </div>
            <button id="btn-publish" class="btn btn-primary btn-sm" disabled="disabled" wutsi-track-event="story.editor.publish" th:text="#{button.publish}">Publish</button>
        </div>
    </div>

    <div class="row border-bottom">
        <div class="col-12 padding title-container">
            <input id="title" name="title" value="" th:placeholder="#{page.editor.title}" autocomplete="off" maxlength="200" />
        </div>
    </div>

    <div class="row">
        <div class="col-12 editorjs-container">
            <div id="editorjs"></div>
        </div>
    </div>


</div>

<script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/header@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/delimiter@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/list@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/quote@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/code@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/embed@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/marker@latest"></script>
<!--
<script src="https://cdn.jsdelivr.net/npm/@editorjs/simple-image@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/checklist@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/link@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/table@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/warning@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@editorjs/inline-code@latest"></script>
-->
<script src="/assets/wutsi/js/wutsi-editorjs.js"></script>

<script th:inline="javascript">
/*<![CDATA[*/

    function publish(story) {
        window.location.href = '/story/' + story.id + '/publish';
    }

    var storyId = /*[[${storyId}]]*/'0';
    $(document).ready(function(){
        var editor = new WutsiEJS('editorjs', publish);
        console.log('editor', editor);

        if (storyId > 0){
            console.log('Loading Story#' + storyId);
            $
                .ajax({
                    method: 'GET',
                    url: '/story/' + storyId + '/editor/fetch',
                    dataType: 'json',
                    contentType: 'application/json'
                })
                .done( function(story) {
                        editor.setup(story);
                    })
                .fail(function(error) {
                        console.error('Unable to load the Story#' + storyId, error)
                    });
        } else {
            editor.setup(null);
        }
    });


/*]]>*/
</script>

<div th:replace="components/layout :: footer"></div>
</body>

</html>
