<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<body>

<div th:fragment="widget" id="survey-container" class="flex padding box-filled-highlight-light border rounded hidden">
    <div class="margin-right">
        <img width="64" th:src="${page.assetUrl} + '/assets/wutsi/img/survey.png'" />
    </div>
    <div style="width: 100%">
        <p>
            <span th:text="#{survey.description}"></span>
            <a class="close" wutsi-track-event="survey_close"><i class="fas fa-times"></i></a>
        </p>
        <button class='btn btn-primary btn-sm' wutsi-track-event="survey" th:utext="#{button.answer_survey}">Answer Survey...</button>
    </div>

    <script th:inline="javascript">
        $(document).ready(function(){
            wutsi.httpGet('/survey', true)
                .then(function(survey){
                    if (survey.active){
                        $('#survey-container button').attr('data-url', survey.url);
                        $('#survey-container').removeClass('hidden');

                        wutsi.track('survey_show');
                    }
                });

        });

        $('#survey-container .close').click(function(){
            wutsi.httpGet('/survey/click', true)
                .finally(function(){
                    $('#survey-container').hide();
                });
        });

        $('#survey-container button').click(function(){
            wutsi.httpGet('/survey/click', true)
                .finally(function(){
                    $('#survey-container').hide();

                    const url = $('#survey-container button').attr('data-url');
                    window.open(url, '_survey');
                });
        });

    </script>
</div>


</body>
</html>
