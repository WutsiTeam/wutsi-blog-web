<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<body>

<div  th:fragment="toolbar">
    <a id="toolbar-syndicate" class="btn btn-light float-right" href="/me/syndicate" th:text="#{button.syndicate_story}">Syndicate Story</a>
    <a id="toolbar-create" class="btn btn-primary margin-right float-right" href="/editor" th:text="#{button.create_story}">New Story</a>
    <div class="clearfix"></div>
</div>

<ul th:fragment="tabs(status, totalDraftStories, totalPublishedStories)" class="nav nav-tabs">
    <li class="nav-item">
        <a id="tab-draft" class="nav-link" href="/me/draft"  th:classappend="${status} == 'draft' ? 'active' : null">
            <span th:text="#{story.status.draft}">Draft</span>
            <span class="story-count badge badge-light hidden">9</span>
        </a>
    </li>
    <li class="nav-item">
        <a id="tab-published" class="nav-link" href="/me/story/published" th:classappend="${status} == 'published' ? 'active' : null">
            <span th:text="#{story.status.published}">Published</span>
            <span class="story-count badge badge-light hidden">9</span>
        </a>
    </li>

    <script>
        $(document).ready(function(){
            update_story_count('draft');
            update_story_count('published');
        });

        function update_story_count(status){
            wutsi.httpGet('/story/count?status=' + status, true)
                .then(function(response){
                    var id = '#tab-' + status + ' .story-count';
                    if (response.count > 0){
                        $(id).removeClass('hidden');
                        $(id).text(response.count)
                    } else {
                        $(id).addClass('hidden');
                    }
                })
        }
    </script>
</ul>

<div th:fragment="listitem(story)" class="story col-12" th:id="'story-' + ${story.id}">

    <a th:href="${story.draft} OR !${story.live} ? '/editor/' + ${story.id} : ${story.slug}">
        <h3 class="title">
            <span th:text="${story.title}">Title</span>
            <span th:replace="components/story :: wpp-badge(${story})"></span>
        </h3>
        <h3 class="disabled" th:text="#{story.no_title}" th:if="${story.title.isEmpty()}">Title</h3>
        <div th:if="${story.published}" class="live" th:classappend="${story.live}? 'live-on' : 'live-off'">
            <span th:if="${story.live}"> <i class="fas fa-toggle-on"></i> </span>
            <span th:if="!${story.live}"> <i class="fas fa-toggle-off"></i> </span>

            <span th:text="#{label.online}">Live</span>
        </div>

        <div class="summary" th:text="${story.summary}">Summary</div>
        <div class="disabled" th:text="#{story.no_summary}" th:if="${story.summary.isEmpty()}">Summary</div>
    </a>

    <div class="meta">
        <span th:text="#{label.modified}">Last Modified:</span> <span th:text="${story.modificationDateTime}">2 days ago</span>
        -
        <span th:text="#{story.read_time(${story.readingMinutes})}" th:if="${story.readingMinutes} GT 0">6 min</span>
        (<span th:text="#{story.word_count(${story.wordCount})}">250 mots</span>)

        <div class="dropdown show story-dropdown-menu margin-left">
            <a class="btn btn-light btn-sm" href="#" role="button" th:id="'story-menu-' + ${story.id}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-ellipsis-h"></i>
            </a>

            <div th:id="'story-menu' + ${story.id}" class="dropdown-menu" th:aria-labelledby="'story-menu' + ${story.id}">
                <a class="dropdown-item menu-item-edit" th:href="'/editor/' + ${story.id}" th:text="#{button.edit}">Edit</a>

                <a class="dropdown-item menu-item-preview" target="_new"
                   th:href="'/me/story/' + ${story.id} + '/preview'"
                   th:text="#{button.preview}"
                   th:if="${story.draft} OR !${story.live}"
                >Preview</a>

                <a class="dropdown-item menu-item-publish"
                   th:href="'/me/story/' + ${story.id} + '/publish'"
                   th:text="#{button.publish}"
                   th:if="${story.draft}"
                >Publish</a>
                <a class="dropdown-item menu-item-stats" th:href="'/stats/story/' + ${story.id}" th:text="#{button.stats}" th:if="${story.published}">Stats</a>
            </div>
        </div>
    </div>
</div>

<div th:fragment="author-card(me)" class="author flex" th:with="inBlogPage=${page.name == 'page.blog'}">
    <a th:href="${me.slug}" th:title="${me.fullName}"><img class="margin-right" th:src="${me.pictureUrl}" th:alt="${me.fullName}" /></a>
    <div>
        <h1 th:text="${me.fullName}" th:if="${inBlogPage}">Ray Sponsible</h1>
        <a th:href="${me.slug}" th:if="!${inBlogPage}" th:text="${me.fullName}">Ray Sponsible</a>

        <div class="bio" th:if="${me.biography}" th:text="${me.biography}" classappend="!${inBlogPage} ? text-small">Biography</div>
        <div th:if="${me.websiteUrl} AND !${me.websiteUrl.isEmpty()}" classappend="!${inBlogPage} ? text-small">
            <a class="website"
               wutsi-track-event="link"
               wutsi-track-value="website"
               th:href="${me.websiteUrl}" th:text="${me.websiteUrl}"
            >http://www.fldkl.com</a>
        </div>
        <div class="margin-top">
            <a target="_new"
               class="social-link facebook"
               wutsi-track-event="link"
               wutsi-track-value="facebook"
               th:if="${me.facebookUrl} AND !${me.facebookUrl.isEmpty()}"
               th:href="${me.facebookUrl}"
            >
                <i class="fab fa-facebook-f"></i>
            </a>
            <a target="_new"
               class="social-link twitter"
               wutsi-track-event="link"
               wutsi-track-value="twitter"
               th:if="${me.twitterUrl} AND !${me.twitterUrl.isEmpty()}"
               th:href="${me.twitterUrl}"
            >
                <i class="fab fa-twitter"></i>
            </a>
            <a target="_new"
               class="social-link youtube"
               wutsi-track-event="link"
               wutsi-track-value="youtube"
               th:if="${me.youtubeUrl} AND !${me.youtubeUrl.isEmpty()}"
               th:href="${me.youtubeUrl}"
            >
                <i class="fab fa-youtube-square"></i>
            </a>
            <a target="_new"
               class="social-link linkedin"
               wutsi-track-event="link"
               wutsi-track-value="linkedin"
               th:if="${me.linkedinUrl} AND !${me.linkedinUrl.isEmpty()}"
               th:href="${me.linkedinUrl}"
            >
                <i class="fab fa-linkedin-in"></i>
            </a>
        </div>
    </div>
</div>

<div th:fragment="author-summary-card(me)" class="author flex">
    <a th:href="${me.slug}"><img class="margin-right" th:src="${me.pictureUrl}" th:alt="${me.fullName}" /></a>
    <div>
        <a th:href="${me.slug}" th:title="${me.fullName}" th:text="${me.fullName}">Ray Sponsible</a>
        <div class="text-small bio" th:if="${me.biography}" th:text="${me.biography}">Biography</div>
    </div>
</div>


<div th:fragment="story-card(story, trackEvent, rank)">
    <a th:href="${story.slug}"
       th:title="${story.title}"
       th:wutsi-track-value = "${story.id}"
       th:wutsi-track-rank = "${rank}"
       th:attrappend="wutsi-track-event= ${trackEvent} ? ${trackEvent}">
        <h2 class="title" th:text="${story.title}">Title</h2>

        <div class="img-container margin-bottom" th:if="${story.thumbnailImage}">
            <img class="border large lozad"
                 th:data-src="${story.thumbnailImage.src}"
                 th:data-srcset="${story.thumbnailImage.srcset}"
                 th:sizes="${story.thumbnailImage.sizes}"
                 th:alt="${story.title}"
            />
        </div>

        <p class="summary" th:text="${story.summary}">Summary</p>
    </a>

    <a th:href="${story.user.slug}" th:title="${story.user.fullName}">
        <div class="author" th:text="${story.user.fullName}">Ray Sponsible</div>
    </a>

    <div class="meta flex">
        <div class="margin-right" th:text="${story.publishedDateTime}">12 May</div>
        <div>
            <span th:text="${story.readingMinutes}">2</span>
            <span th:text="#{label.minutes}">min</span>
        </div>
    </div>
</div>

<div th:fragment="story-summary-card(story, showAuthor, trackEvent, rank)">
        <div class="container-fluid">
            <div class="row">
                <div class="padding-none"
                     th:classappend="${story.thumbnailImage} AND ${showAuthor} ? col-9"
                >
                    <a th:href="${story.slug}"
                       th:title="${story.title}"
                       th:wutsi-track-value = "${story.id}"
                       th:wutsi-track-rank = "${rank}"
                       th:attrappend="wutsi-track-event= ${trackEvent} ? ${trackEvent}">
                        <h6 th:text="${story.title}">Title</h6>
                    </a>

                    <a th:href="${story.user.slug}" th:title="${story.user.fullName}">
                        <div class="author margin-top" th:text="${story.user.fullName}">Ray Sponsible</div>
                    </a>
                    <div class="meta flex">
                        <div class="margin-right" th:text="${story.publishedDateTime}">12 May</div>
                        <div>
                            <span th:text="${story.readingMinutes}">2</span>
                            <span th:text="#{label.minutes}">min</span>
                        </div>
                    </div>
                </div>
                <div class="col-3 text-right padding-none" th:if="${story.thumbnailImage} AND ${showAuthor}">
                    <a th:href="${story.slug}"
                       th:title="${story.title}"
                       th:wutsi-track-value = "${story.id}"
                       th:wutsi-track-rank = "${rank}"
                       th:attrappend="wutsi-track-event= ${trackEvent} ? ${trackEvent}">
                        <img class="small lozad"
                             th:data-src="${story.thumbnailImage.src}"
                             th:data-srcset="${story.thumbnailImage.srcset}"
                             th:sizes="${story.thumbnailImage.sizes}"
                             th:if="${story.thumbnailUrl} AND !${story.thumbnailUrl.isEmpty()}"
                        />
                    </a>
                </div>
            </div>
        </div>
    </a>
</div>


<div class="wizard" th:fragment="wizard(steps, current)">
    <ul class="step-indicator">
        <li th:classappend="${current} GE 1 ? active" th:if="${steps} GE 1"></li>
        <li th:classappend="${current} GE 2 ? active" th:if="${steps} GE 2"></li>
        <li th:classappend="${current} GE 3 ? active" th:if="${steps} GE 3"></li>
        <li th:classappend="${current} GE 4 ? active" th:if="${steps} GE 4"></li>
        <li th:classappend="${current} GE 5 ? active" th:if="${steps} GE 5"></li>
        <li th:classappend="${current} GE 6 ? active" th:if="${steps} GE 6"></li>
    </ul>
    <div class="clearfix"></div>
</div>

<span th:fragment="wpp-badge(story)">
    <i th:if="${story.wppStatus} AND ${story.wppStatus.name()} == 'approved'"
       class="fas fa-dollar-sign story-wpp-approved"
       data-toggle="popover"
       title="Wutsi Partner Program"
       th:data-content="#{story.wpp.approved}"
    ></i>

    <i th:if="${story.wppStatus} AND ${story.wppStatus.name()} == 'rejected'"
       class="fas fa-dollar-sign story-wpp-rejected"
       data-toggle="popover"
       title="Wutsi Partner Program"
       th:data-content="#{story.wpp.rejected}"
    ></i>
</span>

<div th:fragment="share(story)" class="share">

    <button class="btn btn-primary btn-block hidden">
        <i class="fas fa-share-alt"></i>
        <span th:text="#{button.share}">Share</span>
    </button>

    <div class="fallback hidden">
        <a target="_blank" class="share-whatsapp btn-share hidden"
           wutsi-track-event="share"
           wutsi-track-value="whatsapp"
           data-action="share/whatsapp/share"
           th:href="'whatsapp://send?text=' + ${page.url}">
            <i class="fab fa-whatsapp-square"></i>
        </a>
        <a target="_blank" class="share-facebook btn-share"
           wutsi-track-event="share"
           wutsi-track-value="facebook"
           th:href="'https://www.facebook.com/sharer/sharer.php?display=page&u=' + ${page.url}">
            <i class="fab fa-facebook-square"></i>
        </a>
        <a target="_blank" class="share-twitter btn-share"
           wutsi-track-event="share"
           wutsi-track-value="twitter"
           th:href="'http://www.twitter.com/intent/tweet?url=' + ${page.url}">
            <i class="fab fa-twitter-square"></i>
        </a>
        <script>
            $(document).ready(function(){
                if (wutsi.isMobile()){
                    $('.share-whatsapp').removeClass('hidden');
                }
            });
        </script>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/

        const shareButton = /*[[${toggles.shareButton}]]*/'0';

        $(document).ready(function(){
            if (shareButton && navigator.share){
                $('.share button').removeClass('hidden');
            } else {
                $('.share .fallback').removeClass('hidden');
            }

            $('.share button').click(function(){
                const request = {
                    title: $("meta[property=og\\:title]").attr("content"),
                    url: $("meta[property=og\\:url]").attr("content")
                };

                console.log('sharing ', request);
                navigator.share(request).then(function(event){
                    console.log('Share succeed', event);
                    wutsi.track('share');
                }).catch(function(error){
                    console.error('Share failed', error);
                });
            });
        });

        /*]]>*/
    </script>
</div>


<div th:fragment="comment(story)" class="comment-tool">
    <a href="javascript: comment_show()" th:title="#{comment.title}">
        <i class="fas fa-comment-alt fa-2x"></i>
        <span id="comment-count"></span>
    </a>
    <div id="comment-widget" class="border"></div>

    <script id="comment-script" th:inline="javascript">
    /*<![CDATA[*/
        var wcomment;

        $(document).ready(function(){
            wcomment = new WutsiComment(/*[[${story.id}]]*/ '0');
            wcomment.load();
        });

        function comment_show(){
            wcomment.show();
        }
        function comment_hide(){
            wcomment.hide();
        }
    /*]]>*/
    </script>
</div>

</body>
</html>
